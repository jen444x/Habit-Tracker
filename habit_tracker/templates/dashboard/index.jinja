{% extends 'base.jinja' %}

{% block header %}
{% endblock %}

{% block content %}
  {# Date navigator #}
  <div class="flex items-center justify-center gap-4 mb-4">
    <a
      href="{{ url_for('dashboard.index', date=prev_date.strftime('%Y-%m-%d'), challenge=challenge_filter) if challenge_filter else url_for('dashboard.index', date=prev_date.strftime('%Y-%m-%d')) }}"
      class="p-2 text-gray-400 hover:text-calm-600 transition-colors"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </a>
    <div class="text-center">
      <span class="text-lg font-medium text-gray-700">
        {% if is_today %}
          Today
        {% else %}
          {{ selected_date.strftime('%a, %b %d') }}
        {% endif %}
      </span>
      {% if not is_today %}
        <a href="{{ url_for('dashboard.index', challenge=challenge_filter) if challenge_filter else url_for('dashboard.index') }}" class="block text-xs text-calm-500 hover:text-calm-600">Back to today</a>
      {% endif %}
    </div>
    {% if not is_today %}
    <a
      href="{{ url_for('dashboard.index', date=next_date.strftime('%Y-%m-%d'), challenge=challenge_filter) if challenge_filter else url_for('dashboard.index', date=next_date.strftime('%Y-%m-%d')) }}"
      class="p-2 text-gray-400 hover:text-calm-600 transition-colors"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </a>
    {% else %}
    <div class="p-2 w-9"></div>
    {% endif %}
  </div>

  {# Challenge filter tabs #}
  {% if all_challenges %}
  <div class="flex gap-2 mb-4 overflow-x-auto pb-1 justify-center">
    <a
      href="{{ url_for('dashboard.index', date=selected_date.strftime('%Y-%m-%d')) if not is_today else url_for('dashboard.index') }}"
      class="px-3 py-1 text-sm font-medium rounded-full whitespace-nowrap transition-colors duration-150
        {% if not challenge_filter %}
          bg-calm-500 text-white
        {% else %}
          bg-gray-100 text-gray-500 hover:bg-gray-200
        {% endif %}"
    >All</a>
    {% for c in all_challenges %}
      <a
        href="{{ url_for('dashboard.index', challenge=c['id'], date=selected_date.strftime('%Y-%m-%d')) if not is_today else url_for('dashboard.index', challenge=c['id']) }}"
        class="px-3 py-1 text-sm font-medium rounded-full whitespace-nowrap transition-colors duration-150
          {% if challenge_filter == c['id'] %}
            bg-calm-500 text-white
          {% else %}
            bg-gray-100 text-gray-500 hover:bg-gray-200
          {% endif %}"
      >{{ c['title'] }}</a>
    {% endfor %}
  </div>
  {% endif %}

  {# New habit button #}
  <a
    href="{{ url_for('dashboard.create') }}"
    class="block text-center bg-calm-600 hover:bg-calm-500 text-white py-2 rounded-lg font-bold cursor-pointer text-xl shadow-lg/30 transition-colors duration-150 mb-6"
  >
    + New Habit
  </a>

  {# habits #}
  <div class="flex flex-col gap-4">
    {% for habit in habits %}
      {# Each habit  #}
      <div class="bg-white rounded-xl px-4 py-3 shadow-lg/30 border-2 border-calm-500 transition-all duration-150">
        <div class="flex flex-row items-center gap-3">
          <a
          class="habit flex-1 flex gap-6 min-w-0 hover:opacity-70 transition-opacity"
          href="{{ url_for('dashboard.view', id=habit['id']) }}"
          >
              <h3
                class="font-black text-xl font-bold text-calm-600">
                {{habit['title'] }}
              </h3>
              <p
                class="text-lg text-gray-500 font-sans font-light truncate">
                {{ habit['body'] }}
              </p>
          </a>
          <form
          action="{{ url_for('dashboard.complete', id=habit['id']) }}"
          method="post"
          >
            <input type="hidden" name="date" value="{{ selected_date.strftime('%Y-%m-%d') }}">
            <button
                class="group w-8 h-8 rounded-full border-2 border-calm-500 hover:bg-calm-500 cursor-pointer transition-colors duration-150 flex items-center justify-center"
                title="Complete">
              <svg class="w-4 h-4 text-calm-500 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
              </svg>
            </button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>

  {% if habits_done %}
    <hr class="my-8 border-t border-gray-300">

    <div class="flex flex-col gap-4 mb-6">
      {# List of habits done #}
      {% for habit in habits_done %}
        {# Each habit   #}
        <div class="bg-gray-50 rounded-xl px-4 py-3 border-2 border-gray-300 transition-all duration-150">
          <div class="flex flex-row items-center gap-3">
            <a
            class="habit flex-1 flex gap-6 min-w-0 hover:opacity-70 transition-opacity"
            href="{{ url_for('dashboard.view', id=habit['id']) }}"
            >
              <h3
                class="font-black text-xl font-bold text-gray-400 line-through">
                {{habit['title'] }}
              </h3>
              <p
                class="text-lg text-gray-400 font-sans font-light truncate">
                {{ habit['body'] }}
              </p>
            </a>
            <form
            action="{{ url_for('dashboard.undo_complete', id=habit['id']) }}"
            method="post"
            >
              <input type="hidden" name="date" value="{{ selected_date.strftime('%Y-%m-%d') }}">
              <button
                  class="group w-8 h-8 rounded-full bg-calm-500 hover:bg-calm-400 cursor-pointer transition-colors duration-150 flex items-center justify-center"
                  title="Undo">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                </svg>
              </button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}